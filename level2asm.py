#!/usr/bin/env python3

def is_level_data(line: str) -> bool:
    """Check if line contains level data (not labels, comments, or empty lines)."""
    return not (':' in line or ';' in line or line.strip() == '')


def process_level_block(level_lines: list) -> bool:
    """Process and print a block of level lines."""
    if not level_lines:
        return False
    
    # Calculate max length only from actual level data lines
    max_length = max((len(s) for s in level_lines if is_level_data(s)), default=0)
    
    for line in level_lines:
        if is_level_data(line):
            formatted_line = f'{line:<{max_length}}'
            print(f'  DB "{formatted_line:^20}"')
        else:
            print(line)

    return True


with open("levels.txt", "r") as f:
    lines = f.read().splitlines()

print("; This file is automatically generated by level2asm.py")
print("; from levels.txt and data.nolevels.asm")
print("; Do not edit this file directly.\n")
with open("data.nolevels.asm", "r") as f:
    print(f.read())
print('SECTION "Levels", ROM0')

current_block = []
labels = []
level_num = 0
for line in lines:
    if line.endswith(':'):
        # Process previous block before starting new one
        if process_level_block(current_block):
            level_num += 1
            current_block = []
        labels.append(line[:-1])
    current_block.append(line)

# Process final block
process_level_block(current_block)

print(f'LevelEnd:\n\nDEF LEVEL_NUM EQU {level_num}\n\nLevelTable:')
for label in labels:
    print(f'  DW {label}')